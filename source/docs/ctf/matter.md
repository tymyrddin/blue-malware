| ![Dunkle Materie](../../_static/images/procdot-room-banner.png)
|:--:|
| [THM Room: Dunkle Materie](https://tryhackme.com/room/dunklematerieptxc9) |

# THM Dunkle Materie

The firewall alerted the Security Operations Center that one of the machines at the Sales department, which stores 
all the customers' data, contacted the malicious domains over the network. When the Security Analysts looked closely, 
the data sent to the domains contained suspicious base64-encoded strings. The Analysts involved the Incident Response 
team in pulling the Process Monitor and network traffic data to determine if the host is infected. But once they got 
on the machine, they knew it was a ransomware attack by looking at the wallpaper and reading the ransomware note.

Find more evidence of compromise on the host and what ransomware was involved in the attack.

## Questions

**Provide the two PIDs spawned from the malicious executable. (In the order as they appear in the analysis tool)**

Upload the `Logfile.CSV` and `traffic.pcap` files from the `Analysis Files` to `ProcDot` and select the `Launcher` 
button to select a process from the list. After doing so a list of processes that were active while procmon was 
monitoring will appear. The PIDS: (`8644,7128`)

**Provide the full path where the ransomware initially got executed? (Include the full path in your answer)**

Once `ProcDot` graphs all active processes and network activity, after looking through the data, the path where 
`exloreer.exe` was initially executed is found: `c:\users\sales\appdata\local\temp\exploreer.exe`.

**This ransomware transfers the information about the compromised system and the encryption results to two domains 
over HTTP POST. What are the two C2 domains? (no space in the answer)**

**What are the IPs of the malicious domains? (no space in the answer)**

Go to the second instance of the malicious process `7128`. Scroll through the captured data to find the segment where 
`exploreer.exe` is sending and receiving a stream of TCP traffic from `cisco[.]com`, 
`mojobiden[.]com IP: 146.112.61.108`, and `paymenthacks[.]com IP: 206.188.197.206`.

**Provide the user-agent used to transfer the encrypted data to the C2 channel.**

Right-click on the `mojobiden` server and click `Follow TCP Stream`. Scroll down until you see information in 
red text to find the User-Agent information (`Firefox/89.0`). 

**Provide the cloud security service that blocked the malicious domain.**

Right-click on the Cisco Server bubble to find `Cisco Umbrella`.

**Provide the name of the bitmap that the ransomware set up as a desktop wallpaper.**

**Find the PID (Process ID) of the process which attempted to change the background wallpaper on the victim's machine.**

Follow the thread 4892 created by 7128 to find a value set in the register path `HKCU\Control Panel\Desktop\Wallpaper`. 
The value is `c:\programdata\ley9kpi9r.bmp`.

**The ransomware mounted a drive and assigned it the letter. Provide the registry key path to the mounted drive, including the drive letter.**

Follow 4892 to find the registry path for the mounted device: `HKLM\SYSTEM\MountedDevices\DosDevices\Z:`.

**Now you have collected some IOCs from this investigation. Provide the name of the ransomware used in the attack. (external research required)**

Look up the C2 servers on threat intel sites like VirusTotal and AlienVault to find `BlackMatter Ransomware`

